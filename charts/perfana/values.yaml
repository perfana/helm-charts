# Perfana component values.

# Database configuration (PostgreSQL)
database:
  host: ""
  port: 5432
  name: perfana
  username: ""
  password:
    secretName: ""
    key: DB_PASSWORD

# Redis configuration (for BullMQ)
redis:
  host: ""
  port: 6379
  password:
    secretName: ""
    key: REDIS_PASSWORD

# Keycloak configuration
keycloak:
  url: ""
  realm: perfana
  clientId: perfana
  clientSecret:
    secretName: ""
    key: KEYCLOAK_CLIENT_SECRET

# optional image pull secret
# imagePullSecrets:
#   - name: regcred

securityContext: {}
containerSecurityContext: {}

# =============================================================================
# perfana-web: Next.js frontend application
# =============================================================================
perfanaWeb:
  enabled: true
  replicaCount: 1
  image:
    repository: perfana/perfana-web
    tag: perfana-4.0.0
    pullPolicy: Always
  deploymentStrategy: RollingUpdate
  command: []
  args: []
  labels: {}
  annotations: {}
  service:
    type: ClusterIP
    port: 4001
    targetPort: http
  ingress:
    enabled: false
    # ingressClassName: nginx
    # annotations:
    #   kubernetes.io/ingress.class: nginx
    #   cert-manager.io/cluster-issuer: "<issuer>"
    # hosts:
    #   - host: <hostname>
    #     paths:
    #       - path: /
    #         pathType: ImplementationSpecific
    # tls:
    #   - hosts:
    #       - <hostname>
    #     secretName: perfana-<hostname>-tls
  resources: {}
    # limits:
    #  cpu: 2
    #  memory: 2Gi
    # requests:
    #  cpu: 1
    #  memory: 512Mi
  extraEnvSecrets: {}
  # ENV_VAR_NAME:
  #   name: secret-name
  #   key: secret-key
  env:
    NEXT_PUBLIC_API_URL: "http://perfana-api:3001/api"
    NEXT_PUBLIC_KEYCLOAK_URL: ""
    NEXT_PUBLIC_KEYCLOAK_REALM: "perfana"
    NEXT_PUBLIC_KEYCLOAK_CLIENT_ID: "perfana"
  nodeSelector: {}
  tolerations: []
  topologySpreadConstraints: {}
  affinity: {}
  volumes: []
  volumeMounts: []
  serviceAccount:
    enabled: false
    name: perfana-web

# =============================================================================
# perfana-api: NestJS REST API backend
# =============================================================================
perfanaApi:
  enabled: true
  replicaCount: 1
  image:
    repository: perfana/perfana-api
    tag: perfana-4.0.0
    pullPolicy: Always
  deploymentStrategy: RollingUpdate
  command: []
  args: []
  labels: {}
  annotations: {}
  service:
    type: ClusterIP
    port: 3001
    targetPort: http
  resources: {}
    # limits:
    #  cpu: 2
    #  memory: 2Gi
    # requests:
    #  cpu: 1
    #  memory: 512Mi
  nodeSelector: {}
  tolerations: []
  topologySpreadConstraints: {}
  affinity: {}
  volumes: []
  volumeMounts: []
  extraEnvSecrets: {}
  # DB_PASSWORD:
  #   name: postgres-secret
  #   key: password
  # KEYCLOAK_CLIENT_SECRET:
  #   name: keycloak-secret
  #   key: client-secret
  env:
    NODE_ENV: production
    DB_HOST: ""
    DB_PORT: "5432"
    DB_NAME: "perfana"
    DB_USERNAME: ""
    KEYCLOAK_URL: ""
    KEYCLOAK_REALM: "perfana"
    KEYCLOAK_CLIENT_ID: "perfana"
    REDIS_HOST: ""
    REDIS_PORT: "6379"
  serviceAccount:
    enabled: false
    name: perfana-api

# =============================================================================
# perfana-worker: Background job processing with BullMQ
# =============================================================================
perfanaWorker:
  enabled: true
  replicaCount: 1
  image:
    repository: perfana/perfana-worker
    tag: perfana-4.0.0
    pullPolicy: Always
  deploymentStrategy: RollingUpdate
  command: []
  args: []
  labels: {}
  annotations: {}
  resources: {}
    # limits:
    #  cpu: 2
    #  memory: 2Gi
    # requests:
    #  cpu: 1
    #  memory: 512Mi
  nodeSelector: {}
  tolerations: []
  topologySpreadConstraints: {}
  affinity: {}
  volumes: []
  volumeMounts: []
  extraEnvSecrets: {}
  # DB_PASSWORD:
  #   name: postgres-secret
  #   key: password
  env:
    NODE_ENV: production
    DB_HOST: ""
    DB_PORT: "5432"
    DB_NAME: "perfana"
    DB_USERNAME: ""
    REDIS_HOST: ""
    REDIS_PORT: "6379"
  serviceAccount:
    enabled: false
    name: perfana-worker

# =============================================================================
# perfana-grafana-sync: Grafana dashboard synchronization service
# =============================================================================
perfanaGrafanaSync:
  enabled: true
  replicaCount: 1
  image:
    repository: perfana/perfana-grafana-sync
    tag: perfana-4.0.0
    pullPolicy: Always
  command: []
  args: []
  labels: {}
  annotations: {}
  resources: {}
    # limits:
    #  cpu: 1
    #  memory: 1Gi
    # requests:
    #  cpu: 500m
    #  memory: 512Mi
  nodeSelector: {}
  tolerations: []
  topologySpreadConstraints: {}
  affinity: {}
  volumes: []
  volumeMounts: []
  extraEnvSecrets: {}
  # DB_PASSWORD:
  #   name: postgres-secret
  #   key: password
  env:
    NODE_ENV: production
    DB_HOST: ""
    DB_PORT: "5432"
    DB_NAME: "perfana"
    DB_USERNAME: ""
    GRAFANA_SYNC_ENABLED: "true"
    GRAFANA_SYNC_INTERVAL_MINUTES: "60"
    AUTO_CONFIG_ENABLED: "true"
    SANITY_CHECK_ENABLED: "true"
  envFromSecrets: []
  serviceAccount:
    enabled: false
    name: perfana-grafana-sync

# =============================================================================
# DEPRECATED: Legacy services (kept for reference during migration)
# =============================================================================
# The following services have been removed in Perfana 4.0:
# - perfanaFe (replaced by perfanaWeb)
# - perfanaCheck (functionality moved to perfanaApi)
# - perfanaDsApi (replaced by perfanaApi)
# - perfanaDsWorker (replaced by perfanaWorker)
# - perfanaDsMetricWorker (consolidated into perfanaWorker)
# - perfanaMcp (removed)
# - perfanaChat (removed)
# - perfanaGrafana (replaced by perfanaGrafanaSync)
# - perfanaSnapshot (functionality moved to perfanaApi)
# - perfanaScheduler (functionality moved to perfanaGrafanaSync)
